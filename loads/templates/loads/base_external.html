{% extends 'loads/base.html' %}

{% block menu %}

{% load static %}
{% load tags %}
{% load tz %}

{% url 'external_index' as index %}
{% url 'external_modules_index' semesters="" as external_modules_index %}
{% url 'tasks_index' as tasks_index %}
{% url 'programmes_index' as programmes_index %}

{# Create top-level menus, and possibly some dropdowns #}
<nav class="navbar navbar-expand-lg fixed-top text-body bg-body-secondary opacity-100" style="height:80px" id="menuTopWAM">
    <div class="container-fluid p-1">
        <button class="navbar-toggler ms-2 me-2"
                type="button"
                data-bs-toggle="offcanvas"
                data-bs-target="#navbarWAM"
                aria-controls="navbarWAM" aria-expanded="false"
                aria-label="Toggle navigation"
                title="Navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand float-start" href="{% url 'index' %}external/">
            {# TODO: We need to make this logo, and link, customizable #}
            {# The max-height should, however, remain as to not disrupt the layout, etc #}
            <img src="{% static 'logos/WAM_logo.png' %}"
                 style="max-height: 48px" title="Workload and Assessment Modeller" alt="WAM" />
            {# <pre>|{{ request.resolver_match.view_name }}|</pre> #}
        </a>
        <div class="offcanvas offcanvas-start" id="navbarWAM" tabindex="-1">
            {# I'm guessing these can be dynamically generated based on which modules are active, etc #}
            {# TODO: We should add 'aria-current="page"' on the active menu choice                    #}
            <div class="offcanvas-header text-start justify-content-between">
                    <button type="button" class="btn btn-close ms-0" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    <h5 class="offcanvas-title me-0" id="offcanvasNavbarLabel">Menu</h5>
            </div>
            <div class="offcanvas-body">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0 small">
                <li class="nav-item">
                    <a class="nav-link{%if home_page %} active{% endif %}"
                       {%if home_page %}aria-current="page"{% endif %} href="{% url 'external_index' %}"
                       title="click to access section: Home">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link{% if request.resolver_match.view_name|slice:":5" == "tasks" or request.resolver_match.view_name == "create task" %} active fw-bold{% endif %}" href="{% url 'tasks_index' %}"
                       title="click to access section: Tasks">Tasks</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link{% if request.resolver_match.view_name|slice:":17" == "external_modules_" or request.resolver_match.view_name == "modules_details" or request.resolver_match.view_name == "staff_module_allocation" or request.resolver_match.view_name == "module_staff_allocation" %} active fw-bold{% endif %}" href="{% url 'external_modules_index' semesters="" %}"
                       title="click to access section: Modules">Modules</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link{% if request.resolver_match.view_name|slice:":11" == "programmes_" or request.resolver_match.view_name == "view programme" %} active fw-bold{% endif %}" href="{% url 'programmes_index' %}"
                       title="click to access section: Programmes">Programmes</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/profcturner/WAM/wiki"
                       target="_blank" title="click to access section: Help">Help</a>
                </li>
                {% if wam_adfs_auth %}{# This code provides oauth logout where required #}
                    <li class="nav-item">
                        <form id="wam-logout" method="post" action="{% url 'django_auth_adfs:logout' %}">
                        {% csrf_token %}
                            <button type="submit" class="nav-link text-decoration-none" title="Click here to log out">
                                    Logout
                            </button>
                        </form>
                    </li>
                {% else %}
                    {% if not request.meta.remote_user %}
                        {% if logged_in_staff %}
                        <li class="nav-item">
                            <form id="wam-logout" method="post" action="{% url 'external_logout' %}">
                            {% csrf_token %}
                                <button type="submit" class="nav-link text-decoration-none" title="Click here to log out">
                                    Logout
                                </button>
                            </form>
                        </li>
                        {% endif %}
                    {% endif %}
                {% endif %}
            </ul>
            </div>
        </div>
    </div>
</nav>

{% endblock %}